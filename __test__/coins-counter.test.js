/**
 * @jest-environment jsdom
 */

import { createCoinsList, cryptoCount } from '../src/modules/Home';

test('the coin cards displayed in the DOM to be as match as items retreived from api', () => {
  // mocking the API result
  const apiResult = [{
    id: 'bitcoin', symbol: 'btc', name: 'Bitcoin', image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png?1547033579', current_price: 39196, market_cap: 742899826660, market_cap_rank: 1, fully_diluted_valuation: 821957759271, total_volume: 23751619842, high_24h: 39721, low_24h: 38347, price_change_24h: 90.6, price_change_percentage_24h: 0.23168, market_cap_change_24h: -2304178269.3901367, market_cap_change_percentage_24h: -0.3092, circulating_supply: 18980168.0, total_supply: 21000000.0, max_supply: 21000000.0, ath: 69045, ath_change_percentage: -43.22723, ath_date: '2021-11-10T14:24:11.849Z', atl: 67.81, atl_change_percentage: 57707.40786, atl_date: '2013-07-06T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:12:13.133Z',
  }, {
    id: 'ethereum', symbol: 'eth', name: 'Ethereum', image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png?1595348880', current_price: 2611.8, market_cap: 312756652771, market_cap_rank: 2, fully_diluted_valuation: null, total_volume: 12355828990, high_24h: 2623.82, low_24h: 2533.62, price_change_24h: 27.64, price_change_percentage_24h: 1.06955, market_cap_change_24h: 1756147433, market_cap_change_percentage_24h: 0.56468, circulating_supply: 119913269.374, total_supply: null, max_supply: null, ath: 4878.26, ath_change_percentage: -46.44889, ath_date: '2021-11-10T14:24:19.604Z', atl: 0.432979, atl_change_percentage: 603246.44264, atl_date: '2015-10-20T00:00:00.000Z', roi: { times: 88.15669157828545, currency: 'btc', percentage: 8815.669157828544 }, last_updated: '2022-03-11T08:12:29.354Z',
  }, {
    id: 'tether', symbol: 'usdt', name: 'Tether', image: 'https://assets.coingecko.com/coins/images/325/large/Tether-logo.png?1598003707', current_price: 1.001, market_cap: 80083546699, market_cap_rank: 3, fully_diluted_valuation: null, total_volume: 48228865872, high_24h: 1.006, low_24h: 0.996274, price_change_24h: 0.00163839, price_change_percentage_24h: 0.16392, market_cap_change_24h: -94709264.77787781, market_cap_change_percentage_24h: -0.11812, circulating_supply: 80047716084.0496, total_supply: 80047716084.0496, max_supply: null, ath: 1.32, ath_change_percentage: -24.32134, ath_date: '2018-07-24T00:00:00.000Z', atl: 0.572521, atl_change_percentage: 74.89329, atl_date: '2015-03-02T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:11:59.537Z',
  }, {
    id: 'binancecoin', symbol: 'bnb', name: 'BNB', image: 'https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png?1644979850', current_price: 373.81, market_cap: 62781914514, market_cap_rank: 4, fully_diluted_valuation: 62781914514, total_volume: 1702408901, high_24h: 378.15, low_24h: 364.92, price_change_24h: -2.888527192842, price_change_percentage_24h: -0.7668, market_cap_change_24h: -760771385.6652374, market_cap_change_percentage_24h: -1.19726, circulating_supply: 168137035.9, total_supply: 168137035.9, max_supply: 168137035.9, ath: 686.31, ath_change_percentage: -45.53054, ath_date: '2021-05-10T07:24:17.097Z', atl: 0.0398177, atl_change_percentage: 938747.58013, atl_date: '2017-10-19T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:10:19.939Z',
  }, {
    id: 'usd-coin', symbol: 'usdc', name: 'USD Coin', image: 'https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389', current_price: 1.001, market_cap: 52641640755, market_cap_rank: 5, fully_diluted_valuation: null, total_volume: 2976803427, high_24h: 1.005, low_24h: 0.996274, price_change_24h: 0.00211417, price_change_percentage_24h: 0.21164, market_cap_change_24h: 308636063, market_cap_change_percentage_24h: 0.58975, circulating_supply: 52544025205.1208, total_supply: 52544025205.1208, max_supply: null, ath: 1.17, ath_change_percentage: -14.69423, ath_date: '2019-05-08T00:40:28.300Z', atl: 0.891848, atl_change_percentage: 12.17002, atl_date: '2021-05-19T13:14:05.611Z', roi: null, last_updated: '2022-03-11T08:11:46.369Z',
  }, {
    id: 'ripple', symbol: 'xrp', name: 'XRP', image: 'https://assets.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png?1605778731', current_price: 0.745376, market_cap: 35745649440, market_cap_rank: 7, fully_diluted_valuation: 74556664914, total_volume: 3637714543, high_24h: 0.751542, low_24h: 0.724919, price_change_24h: 0.01105176, price_change_percentage_24h: 1.50502, market_cap_change_24h: 395711623, market_cap_change_percentage_24h: 1.11941, circulating_supply: 47944270954.0, total_supply: 100000000000.0, max_supply: 100000000000.0, ath: 3.4, ath_change_percentage: -77.98888, ath_date: '2018-01-07T00:00:00.000Z', atl: 0.00268621, atl_change_percentage: 27747.33108, atl_date: '2014-05-22T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:12:04.710Z',
  }, {
    id: 'terra-luna', symbol: 'luna', name: 'Terra', image: 'https://assets.coingecko.com/coins/images/8284/large/luna1557227471663.png?1567147072', current_price: 99.04, market_cap: 35679107732, market_cap_rank: 6, fully_diluted_valuation: 98791489417, total_volume: 4545729473, high_24h: 103.19, low_24h: 94.38, price_change_24h: 4.0, price_change_percentage_24h: 4.20354, market_cap_change_24h: 1212867362, market_cap_change_percentage_24h: 3.519, circulating_supply: 361155681.95601, total_supply: 774035300.127424, max_supply: 1000000000.0, ath: 103.88, ath_change_percentage: -4.68926, ath_date: '2022-03-09T16:44:02.612Z', atl: 0.121798, atl_change_percentage: 81189.9927, atl_date: '2020-03-18T17:03:01.083Z', roi: null, last_updated: '2022-03-11T08:11:25.660Z',
  }, {
    id: 'solana', symbol: 'sol', name: 'Solana', image: 'https://assets.coingecko.com/coins/images/4128/large/solana.png?1640133422', current_price: 82.43, market_cap: 26340523319, market_cap_rank: 8, fully_diluted_valuation: null, total_volume: 1485717513, high_24h: 83.66, low_24h: 80.63, price_change_24h: 0.01812562, price_change_percentage_24h: 0.02199, market_cap_change_24h: -75967465.44540405, market_cap_change_percentage_24h: -0.28758, circulating_supply: 319644981.894284, total_supply: 508180963.57, max_supply: null, ath: 259.96, ath_change_percentage: -68.33186, ath_date: '2021-11-06T21:54:35.825Z', atl: 0.500801, atl_change_percentage: 16338.51232, atl_date: '2020-05-11T19:35:23.449Z', roi: null, last_updated: '2022-03-11T08:11:59.186Z',
  }, {
    id: 'cardano', symbol: 'ada', name: 'Cardano', image: 'https://assets.coingecko.com/coins/images/975/large/cardano.png?1547034860', current_price: 0.807676, market_cap: 25865439864, market_cap_rank: 9, fully_diluted_valuation: 36297967112, total_volume: 695501568, high_24h: 0.818303, low_24h: 0.787514, price_change_24h: 0.00213065, price_change_percentage_24h: 0.2645, market_cap_change_24h: -88623545.26928711, market_cap_change_percentage_24h: -0.34146, circulating_supply: 32066390668.4135, total_supply: 45000000000.0, max_supply: 45000000000.0, ath: 3.09, ath_change_percentage: -73.83556, ath_date: '2021-09-02T06:00:10.474Z', atl: 0.01925275, atl_change_percentage: 4095.10504, atl_date: '2020-03-13T02:22:55.044Z', roi: null, last_updated: '2022-03-11T08:10:54.979Z',
  }, {
    id: 'avalanche-2', symbol: 'avax', name: 'Avalanche', image: 'https://assets.coingecko.com/coins/images/12559/large/coin-round-red.png?1604021818', current_price: 76.2, market_cap: 20246828958, market_cap_rank: 10, fully_diluted_valuation: 54785319432, total_volume: 1011778640, high_24h: 76.11, low_24h: 72.1, price_change_24h: 3.3, price_change_percentage_24h: 4.52433, market_cap_change_24h: 791104957, market_cap_change_percentage_24h: 4.06618, circulating_supply: 266088014.102576, total_supply: 377752194.4695483, max_supply: 720000000.0, ath: 144.96, ath_change_percentage: -47.88655, ath_date: '2021-11-21T14:18:56.538Z', atl: 2.8, atl_change_percentage: 2596.9855, atl_date: '2020-12-31T13:15:21.540Z', roi: null, last_updated: '2022-03-11T08:10:55.195Z',
  }, {
    id: 'polkadot', symbol: 'dot', name: 'Polkadot', image: 'https://assets.coingecko.com/coins/images/12171/large/polkadot.png?1639712644', current_price: 17.8, market_cap: 19422355819, market_cap_rank: 11, fully_diluted_valuation: null, total_volume: 622753909, high_24h: 17.84, low_24h: 16.73, price_change_24h: 0.865838, price_change_percentage_24h: 5.11241, market_cap_change_24h: 880608660, market_cap_change_percentage_24h: 4.74933, circulating_supply: 1091875876.57289, total_supply: 1172825009.49999, max_supply: null, ath: 54.98, ath_change_percentage: -67.72521, ath_date: '2021-11-04T14:10:09.301Z', atl: 2.7, atl_change_percentage: 557.84109, atl_date: '2020-08-20T05:48:11.359Z', roi: null, last_updated: '2022-03-11T08:11:11.425Z',
  }, {
    id: 'binance-usd', symbol: 'busd', name: 'Binance USD', image: 'https://assets.coingecko.com/coins/images/9576/large/BUSD.png?1568947766', current_price: 1.001, market_cap: 18014027596, market_cap_rank: 12, fully_diluted_valuation: null, total_volume: 3341497690, high_24h: 1.008, low_24h: 0.991362, price_change_24h: 0.00399594, price_change_percentage_24h: 0.40089, market_cap_change_24h: -3463168.668647766, market_cap_change_percentage_24h: -0.01922, circulating_supply: 18006222808.51, total_supply: 18006222808.51, max_supply: null, ath: 1.15, ath_change_percentage: -13.31964, ath_date: '2020-03-13T02:35:42.953Z', atl: 0.901127, atl_change_percentage: 11.02408, atl_date: '2021-05-19T13:04:37.445Z', roi: null, last_updated: '2022-03-11T08:11:01.916Z',
  }, {
    id: 'dogecoin', symbol: 'doge', name: 'Dogecoin', image: 'https://assets.coingecko.com/coins/images/5/large/dogecoin.png?1547792256', current_price: 0.117083, market_cap: 15533621030, market_cap_rank: 13, fully_diluted_valuation: null, total_volume: 522290536, high_24h: 0.118229, low_24h: 0.113665, price_change_24h: 0.00089373, price_change_percentage_24h: 0.7692, market_cap_change_24h: 79448150, market_cap_change_percentage_24h: 0.51409, circulating_supply: 132670764299.894, total_supply: null, max_supply: null, ath: 0.731578, ath_change_percentage: -84.00249, ath_date: '2021-05-08T05:08:23.458Z', atl: 8.69e-05, atl_change_percentage: 134571.11308, atl_date: '2015-05-06T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:11:45.167Z',
  }, {
    id: 'terrausd', symbol: 'ust', name: 'TerraUSD', image: 'https://assets.coingecko.com/coins/images/12681/large/UST.png?1601612407', current_price: 1.008, market_cap: 14429104435, market_cap_rank: 14, fully_diluted_valuation: null, total_volume: 711941852, high_24h: 1.012, low_24h: 0.994539, price_change_24h: 0.00405823, price_change_percentage_24h: 0.40409, market_cap_change_24h: 132110673, market_cap_change_percentage_24h: 0.92405, circulating_supply: 14317151994.6609, total_supply: 14315370959.8563, max_supply: null, ath: 1.092, ath_change_percentage: -7.76665, ath_date: '2021-01-11T22:30:57.984Z', atl: 0.857992, atl_change_percentage: 17.37899, atl_date: '2021-05-19T13:14:26.898Z', roi: null, last_updated: '2022-03-11T08:10:54.138Z',
  }, {
    id: 'shiba-inu', symbol: 'shib', name: 'Shiba Inu', image: 'https://assets.coingecko.com/coins/images/11939/large/shiba.png?1622619446', current_price: 2.258e-05, market_cap: 12392810300, market_cap_rank: 15, fully_diluted_valuation: null, total_volume: 456702048, high_24h: 2.3e-05, low_24h: 2.203e-05, price_change_24h: -2.30977e-07, price_change_percentage_24h: -1.01263, market_cap_change_24h: -184187776.27025986, market_cap_change_percentage_24h: -1.46448, circulating_supply: 549146987315505.4, total_supply: 1.0e+15, max_supply: null, ath: 8.616e-05, ath_change_percentage: -73.79425, ath_date: '2021-10-28T03:54:55.568Z', atl: 5.6e-11, atl_change_percentage: 40056678.92077, atl_date: '2020-11-28T11:26:25.838Z', roi: null, last_updated: '2022-03-11T08:11:04.223Z',
  }, {
    id: 'wrapped-bitcoin', symbol: 'wbtc', name: 'Wrapped Bitcoin', image: 'https://assets.coingecko.com/coins/images/7598/large/wrapped_bitcoin_wbtc.png?1548822744', current_price: 39191, market_cap: 10657559463, market_cap_rank: 16, fully_diluted_valuation: 10657559463, total_volume: 275984774, high_24h: 39685, low_24h: 38360, price_change_24h: 39.92, price_change_percentage_24h: 0.10197, market_cap_change_24h: -5806252.027694702, market_cap_change_percentage_24h: -0.05445, circulating_supply: 271774.7583523, total_supply: 271774.7583523, max_supply: 271774.7583523, ath: 70643, ath_change_percentage: -44.51873, ath_date: '2021-11-10T14:40:19.650Z', atl: 3139.17, atl_change_percentage: 1148.54086, atl_date: '2019-04-02T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:11:27.259Z',
  }, {
    id: 'matic-network', symbol: 'matic', name: 'Polygon', image: 'https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png?1624446912', current_price: 1.45, market_cap: 9958218616, market_cap_rank: 17, fully_diluted_valuation: 14489128122, total_volume: 1141682036, high_24h: 1.46, low_24h: 1.41, price_change_24h: 0.02057102, price_change_percentage_24h: 1.43943, market_cap_change_24h: 116854344, market_cap_change_percentage_24h: 1.18738, circulating_supply: 6872890164.27, total_supply: 10000000000.0, max_supply: 10000000000.0, ath: 2.92, ath_change_percentage: -50.30682, ath_date: '2021-12-27T02:08:34.307Z', atl: 0.00314376, atl_change_percentage: 45997.14824, atl_date: '2019-05-10T00:00:00.000Z', roi: { times: 550.2080826039023, currency: 'usd', percentage: 55020.80826039023 }, last_updated: '2022-03-11T08:12:05.267Z',
  }, {
    id: 'crypto-com-chain', symbol: 'cro', name: 'Cronos', image: 'https://assets.coingecko.com/coins/images/7310/large/oCw2s3GI_400x400.jpeg?1645172042', current_price: 0.387841, market_cap: 9800263209, market_cap_rank: 18, fully_diluted_valuation: null, total_volume: 71454254, high_24h: 0.391493, low_24h: 0.379332, price_change_24h: 0.00395716, price_change_percentage_24h: 1.03082, market_cap_change_24h: 65094966, market_cap_change_percentage_24h: 0.66866, circulating_supply: 25263013692.0, total_supply: 30263013692.0, max_supply: null, ath: 0.965407, ath_change_percentage: -59.85646, ath_date: '2021-11-24T15:53:54.855Z', atl: 0.0121196, atl_change_percentage: 3097.70166, atl_date: '2019-02-08T00:00:00.000Z', roi: null, last_updated: '2022-03-11T08:11:54.972Z',
  }, {
    id: 'dai', symbol: 'dai', name: 'Dai', image: 'https://assets.coingecko.com/coins/images/9956/large/4943.png?1636636734', current_price: 1.001, market_cap: 9394836652, market_cap_rank: 19, fully_diluted_valuation: 9394836652, total_volume: 259632178, high_24h: 1.005, low_24h: 0.995507, price_change_24h: 0.00188303, price_change_percentage_24h: 0.18856, market_cap_change_24h: 13090724, market_cap_change_percentage_24h: 0.13953, circulating_supply: 9388084527.38215, total_supply: 9388084527.38215, max_supply: 9388084527.38215, ath: 1.22, ath_change_percentage: -17.97723, ath_date: '2020-03-13T03:02:50.373Z', atl: 0.903243, atl_change_percentage: 10.69008, atl_date: '2019-11-25T00:04:18.137Z', roi: null, last_updated: '2022-03-11T08:12:43.050Z',
  }, {
    id: 'cosmos', symbol: 'atom', name: 'Cosmos Hub', image: 'https://assets.coingecko.com/coins/images/1481/large/cosmos_hub.png?1555657960', current_price: 27.84, market_cap: 8071129622, market_cap_rank: 20, fully_diluted_valuation: null, total_volume: 774331625, high_24h: 28.52, low_24h: 27.13, price_change_24h: 0.04322221, price_change_percentage_24h: 0.15547, market_cap_change_24h: 1646945, market_cap_change_percentage_24h: 0.02041, circulating_supply: 290059003.23852, total_supply: null, max_supply: null, ath: 44.45, ath_change_percentage: -37.36138, ath_date: '2022-01-17T00:34:41.497Z', atl: 1.16, atl_change_percentage: 2300.01872, atl_date: '2020-03-13T02:27:44.591Z', roi: { times: 277.4496579770552, currency: 'usd', percentage: 27744.96579770552 }, last_updated: '2022-03-11T08:11:45.637Z',
  }];

  // mocking the DOM
  document.body.innerHTML = `
    <p class="coinsCountContainer"></p>
    <ul class="listCoinsContainer"></ul>
    `;
  // call the tested function to create elements in the mocked DOM
  createCoinsList(apiResult, document.querySelector('.listCoinsContainer'), document.querySelector('.coinsCountContainer'));
  // check the list of created elements
  const countLi = document.querySelectorAll('.coin');
  // get the length of fetched items
  const countFetched = cryptoCount(apiResult);
  expect(countLi.length).toBe(countFetched);
});